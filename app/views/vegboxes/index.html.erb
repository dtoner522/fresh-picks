<div class="container">
  <h1>Weekly vegbox delivery</h1>

  <div class="d-flex">
    <% @vegboxes.each do |box| %>
      
      <div>
      
        <img src="https://res.cloudinary.com/dtoner522/image/upload/v1620220338/IMG_20200319_140357574-re-e1584663160830_pkop0u.jpg" alt="" class="w-100 pt-3">
        
        <!-- !box.status to display waitlist form -->
        <% if box.status %>
          <h2 class="mb-3">Ways to get your vegbox:</h2>

            <h5>Veg Box + Delivery Weekly Payment</h5>
            <button
              class="btn btn-primary d-block w-100 mb-3 mb-2"
              id="checkout-button-price_1J0YA7KujJTvt3pozUcXgepe"
              role="link"
              type="button"
            >
              Checkout
            </button>

            <h5>Veg Box + Delivery Monthly Payment</h5>
            <button
              class="btn btn-primary d-block w-100 mb-3"
              id="checkout-button-price_1J0YA7KujJTvt3polSeyiWIB"
              role="link"
              type="button"
            >
              Checkout
            </button>

            <h5>Veg Box Weekly Payment</h5>
            <button
              class="btn btn-primary d-block w-100 mb-3"
              id="checkout-button-price_1J04cMKujJTvt3poqeRrQd2q"
              role="link"
              type="button"
            >
              Checkout
            </button>

            <h5>Veg Box Monthly Payment</h5>
            <button
              class="btn btn-primary d-block w-100 mb-3 hide"
              id="checkout-button-price_1J04cNKujJTvt3poPvnsPLCT"
              role="link"
              type="button"
            >
              Checkout
            </button>




            
          <button class="btn btn-primary d-block w-100 mb-3 hide" id="checkout-button-price_1IsR6AJ9QwKSvn5S4IuzAONE" role="link" type="button"> Order Now!</button>
        <% else %>
         <p>Unfortunately, we've reached capacity for this season :(</p>
         <p>But please input your details below and you'll be the first in line next season!</p>
          <%= render partial: 'customers/new', locals: { box: box } %>
        <% end %>

      </div>

      <div class="col-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Weekly Vegbox</h5>
            <p class="card-text"><%= box.name %></p>
            <p><%= humanized_money_with_symbol(box.price) %></p>
            <h5>What is in a box?</h5>
            <p>Given our very small scale, we can’t itemise every box, therefore we decide what will go in to each box. Within the veg box we plan to;</p>
            <ul>
              <li>– have 8-12 items per week</li>
              <br><li>– lettuce/salad in almost every share</li>
              <br><li>– herbs in every share</li>
              <br><li>Frequent veg to include; carrots, beetroot, salad, spinach, tomatoes, cucumbers, rainbow chard, radishes, peas, beans, baby turnips, kale, Asian greens, courgettes, spring onions, leeks, herbs (mint/ parsley/ basil/ dill/ coriander)</li>
              <br><li>Occasional veg; fennel, kohl rabi, garlic, peppers, celery, potatoes</li>
              <br><li>Please note; as we grow on a very small scale, potatoes and cooking onions will not be staples in the boxes, although they will be in the boxes a few times. We know you love potatoes and think you should definitely go buy delicious locally grown potatoes from other fantastic growers.</li>
              <br><li>Your box will follow the season and be harvested and delivered on the same day.</li>
            </ul>
          </div>
        </div>
      </div>
      
    <% end %>
  </div>

  <div id="error-message"></div>
  <%# need to move this somewhere %>
  <script src="https://js.stripe.com/v3"></script>

<%# weekly payment +delivery %>
  <script>
    (function() {
  var stripe = Stripe('pk_live_51IpzLsKujJTvt3poaj4996zEpJN1LZZgQuZ82qDsXasmEL0qQ2KgbATiC75B6oxXAxbjsW2WDaV3ngaOtdaFbyME00pd7gfRnx');

  var checkoutButton = document.getElementById('checkout-button-price_1J0YA7KujJTvt3pozUcXgepe');
  checkoutButton.addEventListener('click', function () {
    /*
     * When the customer clicks on the button, redirect
     * them to Checkout.
     */
    stripe.redirectToCheckout({
      lineItems: [{price: 'price_1J0YA7KujJTvt3pozUcXgepe', quantity: 1}],
      mode: 'subscription',
      /*
       * Do not rely on the redirect to the successUrl for fulfilling
       * purchases, customers may not always reach the success_url after
       * a successful payment.
       * Instead use one of the strategies described in
       * https://stripe.com/docs/payments/checkout/fulfill-orders
       */
      successUrl: window.location.protocol + '//www.freshpicks.co.uk/success',
      cancelUrl: window.location.protocol + '//www.freshpicks.co.uk/canceled',
    })
    .then(function (result) {
      if (result.error) {
        /*
         * If `redirectToCheckout` fails due to a browser or network
         * error, display the localized error message to your customer.
         */
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
})();
</script>

<%# monthly payment + delivery %>
<script>
(function() {
  var stripe = Stripe('pk_live_51IpzLsKujJTvt3poaj4996zEpJN1LZZgQuZ82qDsXasmEL0qQ2KgbATiC75B6oxXAxbjsW2WDaV3ngaOtdaFbyME00pd7gfRnx');

  var checkoutButton = document.getElementById('checkout-button-price_1J0YA7KujJTvt3polSeyiWIB');
  checkoutButton.addEventListener('click', function () {
    /*
     * When the customer clicks on the button, redirect
     * them to Checkout.
     */
    stripe.redirectToCheckout({
      lineItems: [{price: 'price_1J0YA7KujJTvt3polSeyiWIB', quantity: 1}],
      mode: 'subscription',
      /*
       * Do not rely on the redirect to the successUrl for fulfilling
       * purchases, customers may not always reach the success_url after
       * a successful payment.
       * Instead use one of the strategies described in
       * https://stripe.com/docs/payments/checkout/fulfill-orders
       */
      successUrl: window.location.protocol + '//www.freshpicks.co.uk/success',
      cancelUrl: window.location.protocol + '//www.freshpicks.co.uk/canceled',
    })
    .then(function (result) {
      if (result.error) {
        /*
         * If `redirectToCheckout` fails due to a browser or network
         * error, display the localized error message to your customer.
         */
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
})();
</script>

<%# weekly payment %>
<script>
(function() {
  var stripe = Stripe('pk_live_51IpzLsKujJTvt3poaj4996zEpJN1LZZgQuZ82qDsXasmEL0qQ2KgbATiC75B6oxXAxbjsW2WDaV3ngaOtdaFbyME00pd7gfRnx');

  var checkoutButton = document.getElementById('checkout-button-price_1J04cMKujJTvt3poqeRrQd2q');
  checkoutButton.addEventListener('click', function () {
    /*
     * When the customer clicks on the button, redirect
     * them to Checkout.
     */
    stripe.redirectToCheckout({
      lineItems: [{price: 'price_1J04cMKujJTvt3poqeRrQd2q', quantity: 1}],
      mode: 'subscription',
      /*
       * Do not rely on the redirect to the successUrl for fulfilling
       * purchases, customers may not always reach the success_url after
       * a successful payment.
       * Instead use one of the strategies described in
       * https://stripe.com/docs/payments/checkout/fulfill-orders
       */
      successUrl: window.location.protocol + '//www.freshpicks.co.uk/success',
      cancelUrl: window.location.protocol + '//www.freshpicks.co.uk/canceled',
    })
    .then(function (result) {
      if (result.error) {
        /*
         * If `redirectToCheckout` fails due to a browser or network
         * error, display the localized error message to your customer.
         */
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
})();
</script>

<%# Monthly Payment %>
<script>
(function() {
  var stripe = Stripe('pk_live_51IpzLsKujJTvt3poaj4996zEpJN1LZZgQuZ82qDsXasmEL0qQ2KgbATiC75B6oxXAxbjsW2WDaV3ngaOtdaFbyME00pd7gfRnx');

  var checkoutButton = document.getElementById('checkout-button-price_1J04cNKujJTvt3poPvnsPLCT');
  checkoutButton.addEventListener('click', function () {
    /*
     * When the customer clicks on the button, redirect
     * them to Checkout.
     */
    stripe.redirectToCheckout({
      lineItems: [{price: 'price_1J04cNKujJTvt3poPvnsPLCT', quantity: 1}],
      mode: 'subscription',
      /*
       * Do not rely on the redirect to the successUrl for fulfilling
       * purchases, customers may not always reach the success_url after
       * a successful payment.
       * Instead use one of the strategies described in
       * https://stripe.com/docs/payments/checkout/fulfill-orders
       */
      successUrl: window.location.protocol + '//www.freshpicks.co.uk/success',
      cancelUrl: window.location.protocol + '//www.freshpicks.co.uk/canceled',
    })
    .then(function (result) {
      if (result.error) {
        /*
         * If `redirectToCheckout` fails due to a browser or network
         * error, display the localized error message to your customer.
         */
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
})();
</script>
</div>